<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>City Rush - Final Upgrade</title>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; }
  canvas { background:#87CEEB; display:block; margin:0 auto; }
  #score { position:absolute; top:10px; left:10px; font-size:24px; color:white; }
</style>
</head>
<body>
<div id="score">Score: 0</div>
<canvas id="gameCanvas"></canvas>

<script>
// Canvas setup
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Game variables
let laneCount = 3;
let laneWidth = canvas.width / laneCount;
let player = { lane:1, x:0, y:canvas.height - 150, width:50, height:100, frame:0, frameTick:0 };
let obstacles = [];
let coins = [];
let speed = 5;
let score = 0;
let gameOver = false;

// Placeholder images
let playerImg = new Image();
playerImg.src = 'https://i.imgur.com/6vD1m4p.png'; // simple character sprite placeholder

let coinImg = new Image();
coinImg.src = 'https://i.imgur.com/OYVxw2h.png'; // coin placeholder

let bgImg = new Image();
bgImg.src = 'https://i.imgur.com/qY7Y6oK.png'; // background placeholder

let bgY = 0;

// Controls
document.addEventListener('keydown', e=>{
    if(e.key==='ArrowLeft' && player.lane>0) player.lane--;
    if(e.key==='ArrowRight' && player.lane<laneCount-1) player.lane++;
    if(e.key==='ArrowUp' || e.key===' ') jump();
});

canvas.addEventListener('touchstart', e=>{
    let touchX = e.touches[0].clientX;
    if(touchX < canvas.width/2 && player.lane>0) player.lane--;
    if(touchX >= canvas.width/2 && player.lane<laneCount-1) player.lane++;
});

// Jump
let isJumping=false;
let jumpVelocity=0;
function jump() {
    if(!isJumping){
        isJumping=true;
        jumpVelocity=-15;
    }
}

// Game loop
function gameLoop() {
    if(gameOver){
        ctx.fillStyle="black";
        ctx.font="50px sans-serif";
        ctx.fillText("Game Over", canvas.width/2-150, canvas.height/2);
        ctx.fillText("Score: "+score, canvas.width/2-100, canvas.height/2+60);
        return;
    }

    // Background scroll
    bgY += speed;
    if(bgY > canvas.height) bgY=0;
    ctx.drawImage(bgImg, 0, bgY - canvas.height, canvas.width, canvas.height);
    ctx.drawImage(bgImg, 0, bgY, canvas.width, canvas.height);

    // Player position
    player.x = player.lane * laneWidth + laneWidth/2 - player.width/2;

    // Jump physics
    if(isJumping){
        player.y += jumpVelocity;
        jumpVelocity += 0.8;
        if(player.y >= canvas.height - 150){
            player.y = canvas.height - 150;
            isJumping=false;
            jumpVelocity=0;
        }
    }

    // Obstacles
    if(Math.random()<0.02) obstacles.push({lane:Math.floor(Math.random()*laneCount), y:-100, width:50, height:100});
    obstacles.forEach((obs,i)=>{
        obs.y += speed;
        ctx.fillStyle="red";
        ctx.fillRect(obs.lane*laneWidth + laneWidth/2 - obs.width/2, obs.y, obs.width, obs.height);

        // Collision
        if(obs.lane===player.lane && player.y + player.height > obs.y && player.y < obs.y + obs.height){
            gameOver=true;
        }

        if(obs.y>canvas.height) obstacles.splice(i,1);
    });

    // Coins
    if(Math.random()<0.03) coins.push({lane:Math.floor(Math.random()*laneCount), y:-50, width:30, height:30});
    coins.forEach((coin,i)=>{
        coin.y += speed;
        ctx.drawImage(coinImg, coin.lane*laneWidth + laneWidth/2 - coin.width/2, coin.y, coin.width, coin.height);

        // Collect
        if(coin.lane===player.lane && player.y + player.height > coin.y && player.y < coin.y + coin.height){
            score++;
            document.getElementById("score").innerText = "Score: "+score;
            coins.splice(i,1);
        }

        if(coin.y>canvas.height) coins.splice(i,1);
    });

    // Draw player sprite (simple frame animation)
    player.frameTick++;
    if(player.frameTick>5){player.frame++;player.frameTick=0;}
    if(player.frame>3) player.frame=0; // assuming 4 frames
    ctx.drawImage(playerImg, player.frame*50,0,50,100,player.x,player.y,50,100);

    // Speed increase
    speed += 0.001;

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
